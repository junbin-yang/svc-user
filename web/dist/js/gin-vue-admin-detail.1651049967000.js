/*! 
 Build Time : 1651049967000 */
var e=(e,a,l)=>new Promise(((t,u)=>{var s=e=>{try{d(l.next(e))}catch(a){u(a)}},i=e=>{try{d(l.throw(e))}catch(a){u(a)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,i);d((l=l.apply(e,a)).next())}));import{b as a,d as l,e as t,f as u}from"./gin-vue-admin-app.16510499670002.js";import{J as s,r as i,b as d,o,c as r,d as n,e as m,w as v,G as c,H as p,i as f,t as g,g as h,l as b,f as k,L as y,j as I}from"../gva/gin-vue-admin-index.1651049967000.js";import{f as V}from"./gin-vue-admin-format.1651049967000.js";import"./gin-vue-admin-date.1651049967000.js";import"./gin-vue-admin-dictionary.1651049967000.js";import"./gin-vue-admin-sysDictionary.1651049967000.js";const _={class:"gva-search-box"},S=f("查询"),w=f("重置"),C={class:"gva-table-box"},U={class:"gva-btn-list"},N=f("创建应用角色"),R=f("编辑"),x=f("绑定用户"),z={class:"gva-pagination"},A={key:0,style:{"text-align":"center"}},D={class:"dialog-footer"},$=f("取 消"),j=f("确 定"),O=f("确 定"),P={name:"RolesDetail"},q=Object.assign(P,{setup(P){const q=s(),L=i({data:[],rightValue:[],roleId:null,userIds:[]}),E=(a,l,t)=>e(this,null,(function*(){console.log(a,l,t),L.value.userIds=a}));(()=>{e(this,null,(function*(){const e=[],a=yield y({page:1,limit:999999});200===a.code&&a.data.docs.forEach((a=>{e.push({key:a.ID,label:`${a.NickName} - [ ${a.Account} ] `,disabled:!a.Status})})),L.value.data=e}))})();const K=i(""),T=i([]),F=()=>{const e={};return K.value.getCheckedNodes().forEach((a=>{!0===a.IsLeaf&&(e[a.PCode]|=a.Value)})),console.info(e),e},G={children:"Children",label:"Name",isLeaf:"IsLeaf"},H=i([]),J=e=>{const a=B.value.filter((a=>a.value===e))[0];return a&&`${a.label}`},B=i([{value:!0,label:"启用",type:"success"},{value:!1,label:"禁用",type:"danger"}]),M=i({ID:0,AppKey:"",Name:"",Status:!1,Remark:"",RoleAuthoritys:{},Sequence:"",Other:{}}),Q=i({Name:[{required:!0,message:"请输入角色名",trigger:"blur"}],Status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),W=i(1),X=i(0),Y=i(10),Z=i([]),ee=i({appId:String(q.params.id)}),ae=()=>{ee.value={appId:String(q.params.id)}},le=()=>{W.value=1,Y.value=10,se()},te=e=>{Y.value=e,se()},ue=e=>{W.value=e,se()},se=()=>e(this,null,(function*(){const e={};e[ee.value.appId]=["app_key"],ee.value.name&&(e[ee.value.name]=["name"]),ee.value.desc&&(e[ee.value.desc]=["remark"]),ee.value.status&&(e[ee.value.status]=["status"]);const l=yield a({page:W.value,limit:Y.value,search:e});200===l.code&&(Z.value=l.data.roles.docs,X.value=l.data.roles.total,W.value=l.data.roles.page,Y.value=l.data.roles.limit,H.value=l.data.roleAuthTree)}));se();const ie=i(""),de=i(!1),oe=()=>{T.value=[],de.value=!1,M.value={ID:0,AppKey:"",Name:"",Status:!1,Remark:"",RoleAuthoritys:{},Sequence:"",Other:{}}},re=i(null),ne=()=>e(this,null,(function*(){re.value.validate((a=>e(this,null,(function*(){if(!a)return;let e;switch(ie.value){case"create":e=yield t({AppId:String(q.params.id),Name:M.value.Name,Status:M.value.Status,Remark:M.value.Remark,Permissions:F()});break;case"edit":e=yield l({AppId:String(q.params.id),Id:M.value.ID,Name:M.value.Name,Status:M.value.Status,Remark:M.value.Remark,Permissions:F()});break;case"bindUser":console.info({AppId:String(q.params.id),RoleId:L.value.roleId,UserId:L.value.userIds}),e.code=200}200===e.code&&(I({type:"success",message:e.message}),oe(),se())}))))})),me=()=>e(this,null,(function*(){const e=yield u({AppId:String(q.params.id),RoleId:L.value.roleId,UserId:L.value.userIds});200===e.code&&(I({type:"success",message:e.message}),oe(),se())})),ve=i(""),ce=e=>{switch(e){case"create":default:ve.value="创建角色";break;case"edit":ve.value="编辑角色";break;case"bindUser":ve.value="绑定用户"}ie.value=e,de.value=!0},pe=a=>e(this,null,(function*(){M.value=a,T.value=M.value.Other.checkedNode,ce("edit")})),fe=a=>e(this,null,(function*(){L.value.rightValue=a.Other.assUserIds,L.value.roleId=a.ID,ce("bindUser")}));return(e,a)=>{const l=d("el-input"),t=d("el-form-item"),u=d("el-option"),s=d("el-select"),i=d("el-button"),y=d("el-form"),I=d("el-table-column"),P=d("el-table"),q=d("el-pagination"),F=d("el-transfer"),se=d("el-tree"),ge=d("el-dialog");return o(),r("div",null,[n("div",_,[m(y,{inline:!0,model:ee.value},{default:v((()=>[m(t,{label:"角色名"},{default:v((()=>[m(l,{modelValue:ee.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.name=e),placeholder:"搜索条件"},null,8,["modelValue"])])),_:1}),m(t,{label:"描述"},{default:v((()=>[m(l,{modelValue:ee.value.desc,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.desc=e),placeholder:"搜索条件"},null,8,["modelValue"])])),_:1}),m(t,{label:"启用状态",prop:"status"},{default:v((()=>[m(s,{modelValue:ee.value.status,"onUpdate:modelValue":a[2]||(a[2]=e=>ee.value.status=e),clearable:"",placeholder:"请选择"},{default:v((()=>[(o(!0),r(c,null,p(B.value,(e=>(o(),b(u,{key:e.value,label:`${e.label}(${e.value})`,value:e.value?"1":"0"},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(t,null,{default:v((()=>[m(i,{size:"small",type:"primary",icon:"search",onClick:le},{default:v((()=>[S])),_:1}),m(i,{size:"small",icon:"refresh",onClick:ae},{default:v((()=>[w])),_:1})])),_:1})])),_:1},8,["model"])]),n("div",C,[n("div",U,[m(i,{size:"small",type:"primary",icon:"plus",onClick:a[3]||(a[3]=e=>ce("create"))},{default:v((()=>[N])),_:1})]),m(P,{ref:"multipleTable",data:Z.value,style:{width:"100%"},"tooltip-effect":"dark","row-key":"ID"},{default:v((()=>[m(I,{type:"selection",width:"55"}),m(I,{align:"left",label:"id",prop:"ID","min-width":"60"}),m(I,{align:"left",label:"角色名",prop:"Name","min-width":"100"}),m(I,{align:"left",label:"创建日期","min-width":"120"},{default:v((e=>[f(g(h(V)(e.row.CreatedAt)),1)])),_:1}),m(I,{align:"left",label:"描述",prop:"Remark","min-width":"150"}),m(I,{align:"left",label:"启用状态","min-width":"80",prop:"Status"},{default:v((e=>[n("div",null,g(J(e.row.Status)),1)])),_:1}),m(I,{align:"left",label:"用户数",prop:"UserCount","min-width":"80"}),m(I,{align:"left",label:"按钮组"},{default:v((e=>[m(i,{icon:"edit",size:"small",type:"text",onClick:a=>pe(e.row)},{default:v((()=>[R])),_:2},1032,["onClick"]),m(i,{icon:"setting",size:"small",type:"text",onClick:a=>fe(e.row)},{default:v((()=>[x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),n("div",z,[m(q,{"current-page":W.value,"page-size":Y.value,"page-sizes":[10,30,50,100],total:X.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ue,onSizeChange:te},null,8,["current-page","page-size","total"])])]),m(ge,{modelValue:de.value,"onUpdate:modelValue":a[8]||(a[8]=e=>de.value=e),"before-close":oe,title:ve.value},{footer:v((()=>[n("div",D,[m(i,{size:"small",onClick:oe},{default:v((()=>[$])),_:1}),"bindUser"!==ie.value?(o(),b(i,{key:0,size:"small",type:"primary",onClick:ne},{default:v((()=>[j])),_:1})):k("",!0),"bindUser"===ie.value?(o(),b(i,{key:1,size:"small",type:"primary",onClick:me},{default:v((()=>[O])),_:1})):k("",!0)])])),default:v((()=>["bindUser"==ie.value?(o(),r("div",A,[m(F,{modelValue:L.value.rightValue,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value.rightValue=e),style:{"text-align":"left",display:"inline-block"},filterable:"",titles:["未绑定","已绑定"],"button-texts":["解绑","绑定"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:L.value.data,onChange:E},{default:v((({option:e})=>[n("span",null,g(e.label),1)])),_:1},8,["modelValue","data"])])):k("",!0),"bindUser"!==ie.value?(o(),b(y,{key:1,ref_key:"dialogForm",ref:re,model:M.value,rules:Q.value,size:"medium","label-width":"110px"},{default:v((()=>[m(t,{label:"名称",prop:"Name"},{default:v((()=>[m(l,{modelValue:M.value.Name,"onUpdate:modelValue":a[5]||(a[5]=e=>M.value.Name=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(t,{label:"描述",prop:"Remark"},{default:v((()=>[m(l,{modelValue:M.value.Remark,"onUpdate:modelValue":a[6]||(a[6]=e=>M.value.Remark=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(t,{label:"启用状态",prop:"Status"},{default:v((()=>[m(s,{modelValue:M.value.Status,"onUpdate:modelValue":a[7]||(a[7]=e=>M.value.Status=e),placeholder:"请选择",style:{width:"100%"}},{default:v((()=>[(o(!0),r(c,null,p(B.value,(e=>(o(),b(u,{key:e.value,label:`${e.label}(${e.value})`,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(t,{label:"角色权限",prop:"Auth"},{default:v((()=>[m(se,{ref_key:"treeRef",ref:K,data:H.value,"show-checkbox":"","default-expand-all":"","node-key":"ID","highlight-current":"",props:G,"default-checked-keys":T.value},null,8,["data","default-checked-keys"])])),_:1})])),_:1},8,["model","rules"])):k("",!0)])),_:1},8,["modelValue","title"])])}}});export{q as default};
