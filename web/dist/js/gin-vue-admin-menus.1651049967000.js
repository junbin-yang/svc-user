/*! 
 Build Time : 1651049967000 */
var e=(e,t,a)=>new Promise(((l,o)=>{var s=e=>{try{u(a.next(e))}catch(t){o(t)}},n=e=>{try{u(a.throw(e))}catch(t){o(t)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,n);u((a=a.apply(e,t)).next())}));import{r as t,b as a,o as l,c as o,d as s,e as n,w as u,t as d,R as r,i,f as c,a7 as m,a8 as y,j as h,a9 as f,W as p}from"../gva/gin-vue-admin-index.1651049967000.js";import{u as v}from"./gin-vue-admin-authority.16510499670002.js";import{g as I,s as g}from"./gin-vue-admin-authorityBtn.1651049967000.js";const k={class:"clearflex"},w=i("确 定"),b={class:"custom-tree-node"},C={key:0},x=i(" 分配按钮 "),R={class:"dialog-footer"},_=i("取 消"),D=i("确 定"),j={name:"Menus"},z=Object.assign(j,{props:{row:{default:function(){return{}},type:Object}},emits:["changeRow"],setup(j,{expose:z,emit:N}){const A=j,B=t([]),E=t([]),V=t(!1),O=t({children:"children",label:function(e){return e.meta.title}});(()=>{e(this,null,(function*(){const e=yield m();B.value=e.data.menus;const t=(yield y({authorityId:A.row.authorityId})).data.menus,a=[];t.forEach((e=>{t.some((t=>t.parentId===e.menuId))||a.push(Number(e.menuId))})),E.value=a}))})();const P=t=>e(this,null,(function*(){const e=yield v({authorityId:A.row.authorityId,AuthorityName:A.row.authorityName,parentId:A.row.parentId,defaultRouter:t.name});0===e.code&&(h({type:"success",message:"设置成功"}),N("changeRow","defaultRouter",e.data.authority.defaultRouter))})),S=()=>{V.value=!0},T=t(null),M=()=>e(this,null,(function*(){const e=T.value.getCheckedNodes(!1,!0);0===(yield f({menus:e,authorityId:A.row.authorityId})).code&&h({type:"success",message:"菜单设置成功!"})}));z({enterAndNext:()=>{M()},needConfirm:V});const U=t(!1),W=t([]),q=t([]),F=t();let G="";const H=t=>e(this,null,(function*(){G=t.ID;const e=yield I({menuID:G,authorityId:A.row.authorityId});0===e.code&&(K(t),yield p(),e.data.selected&&e.data.selected.forEach((e=>{W.value.some((t=>{t.ID===e&&F.value.toggleRowSelection(t,!0)}))})))})),J=e=>{q.value=e},K=e=>{U.value=!0,W.value=e.menuBtn},L=()=>{U.value=!1},Q=()=>e(this,null,(function*(){const e=q.value.map((e=>e.ID));0===(yield g({menuID:G,selected:e,authorityId:A.row.authorityId})).code&&(h({type:"success",message:"设置成功"}),U.value=!1)}));return(e,t)=>{const m=a("el-button"),y=a("el-tree"),h=a("el-table-column"),f=a("el-table"),p=a("el-dialog");return l(),o("div",null,[s("div",k,[n(m,{class:"fl-right",size:"small",type:"primary",onClick:M},{default:u((()=>[w])),_:1})]),n(y,{ref_key:"menuTree",ref:T,data:B.value,"default-checked-keys":E.value,props:O.value,"default-expand-all":"","highlight-current":"","node-key":"ID","show-checkbox":"",onCheck:S},{default:u((({node:e,data:t})=>[s("span",b,[s("span",null,d(e.label),1),s("span",null,[n(m,{type:"text",size:"small",style:r({color:j.row.defaultRouter===t.name?"#E6A23C":"#85ce61"}),disabled:!e.checked,onClick:()=>P(t)},{default:u((()=>[i(d(j.row.defaultRouter===t.name?"首页":"设为首页"),1)])),_:2},1032,["style","disabled","onClick"])]),t.menuBtn.length?(l(),o("span",C,[n(m,{type:"text",size:"small",onClick:()=>H(t)},{default:u((()=>[x])),_:2},1032,["onClick"])])):c("",!0)])])),_:1},8,["data","default-checked-keys","props"]),n(p,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),title:"分配按钮","destroy-on-close":""},{footer:u((()=>[s("div",R,[n(m,{size:"small",onClick:L},{default:u((()=>[_])),_:1}),n(m,{size:"small",type:"primary",onClick:Q},{default:u((()=>[D])),_:1})])])),default:u((()=>[n(f,{ref_key:"btnTableRef",ref:F,data:W.value,"row-key":"ID",onSelectionChange:J},{default:u((()=>[n(h,{type:"selection",width:"55"}),n(h,{label:"按钮名称",prop:"name"}),n(h,{label:"按钮备注",prop:"desc"})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}}});export{z as default};
